# CI 工作流程優化

## 優化前的問題

CI 工作流程中存在大量重複的資料庫設置和編譯工作：

1. **test job** - 設置資料庫、運行遷移、編譯、測試
2. **clippy job** - 設置資料庫、運行遷移、編譯、檢查
3. **build job (debug)** - 設置資料庫、運行遷移、編譯
4. **build job (release)** - 設置資料庫、運行遷移、編譯
5. **integration job** - 設置資料庫、運行遷移、編譯、測試

總共執行了 5 次資料庫設置和遷移！

## 優化方案

### 合併相關 Jobs

將具有相似需求的 jobs 合併，減少重複工作：

1. **保留 fmt job** - 不需要資料庫，快速執行
2. **合併 test + clippy** - 都需要編譯和資料庫
3. **刪除 build job** - test 已經會編譯代碼
4. **保留 integration job** - 獨立的集成測試

### 優化後的流程

```
fmt (格式檢查)
  ↓
test-and-clippy (單元測試 + 文檔測試 + clippy)
  ↓
integration (集成測試)
```

### 效果

- 資料庫設置次數：5 → 2
- CI 總執行時間：顯著減少
- 資源使用：大幅降低
- 維護複雜度：簡化

## 其他可能的優化

1. **使用 sqlx offline mode**
   - 執行 `cargo sqlx prepare` 生成查詢快取
   - CI 不再需要真實資料庫連接
   
2. **使用 cargo-nextest**
   - 更快的測試執行器
   - 更好的並行化

3. **分離快速和慢速測試**
   - 快速測試在每個 PR 運行
   - 完整測試套件只在合併時運行